YUI.add("gallery-y-common-dombind",function(Y,NAME){Y.namespace("Common");var ATTRIBUTE_SELECTOR="[{attributeName}]",LOOP_DATA_FILTER="|",FILTER=":",COMMA_SEPARATOR=",",DATA_BIND_CHANGE_EVENT="data-{property}-changed",DATA_IS_BINDED="-isbinded",TEMPLATE="-template",LOG_PREFIX="[Y.Common.DomBind] ",FIELD_TYPES={checkbox:0,radio:1},DATA_ARRAY="Array",SCOPE_VAR_TEMPLATE='var {scopeVarName} = scopeModel["{scopeVarName}"];';Y.Common.DomBind=Y.Base.create("gallery-y-common-dombind",Y.Base,[],{initializer:function(){this._init()},setModel:function(e,t,n,r){this._setModel(e,t,n);var i=this._generateUniqueKey(e,n);this.fire(Y.Lang.sub(DATA_BIND_CHANGE_EVENT,{property:i}),{newValue:t,triggerElement:r})},listen:function(e,t){return this.on(Y.Lang.sub(DATA_BIND_CHANGE_EVENT,{property:e}),function(e){t(e)})},execControllerMethodExpression:function(code,scopeModel,el){var methodName=code.split("(")[0];eval(this._generateScopeVarsCode(scopeModel)),eval(Y.Lang.sub('this.get("controller").{methodName} = Y.bind(this.get("controller").{methodName}, el);',{methodName:methodName})),eval('this.get("controller").'+code)},attachEvent:function(e,t,n){typeof e.getData(t)=="undefined"&&(e.on(t,function(e){n(e)}),e.setData(t,!0))},_init:function(){var e=this;e._compileDirectives({}),this.after("modelChange",function(){e._compileDirectives({})})},_compileDirectives:function(e){for(var t in Y.Common.DomBind.Directives)if(Y.Common.DomBind.Directives.hasOwnProperty(t)){var n=Y.Common.DomBind.Directives[t];this._compileAndExecuteDirective(e,t,n)}},_compileAndExecuteDirective:function(e,t,n){var r=this,i=e&&e.containerNode?e.containerNode:this.get("container"),s=e&&e.scopeModel?e.scopeModel:{},o=i.all(Y.Lang.sub(ATTRIBUTE_SELECTOR,{attributeName:this._getDirectiveName(t)})),u=Y.bind(n.directiveExecFn,this);o.each(function(e){Y.clone(u)(t,e,e.getAttribute(r._getDirectiveName(t)),Y.clone(s))})},_tokenizeFilters:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n].split(FILTER);t.push({name:r[0],executeFn:r[1]})}return t},_doBeforeEachItem:function(e,t){for(var n=0;n<e.length;n++)if(e[n].name=="onBeforeEach"){var r=this.get("filters")[e[n].executeFn];t=r(t)}return t},_doAfterEachItem:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r].name=="onAfterEach"){var i=this.get("filters")[e[r].executeFn];t=i(t,n)}},_setElementValue:function(e,t){var n=e.get("nodeName").toLowerCase();if(n=="input"||n=="textarea"||n=="select"){var r=typeof FIELD_TYPES[e.get("type")]=="number"?FIELD_TYPES[e.get("type")]:e.get("type");switch(r){case FIELD_TYPES.checkbox:e.set("checked",t);break;case FIELD_TYPES.radio:e.set("checked",e.get("value")==t);break;default:e.set("value",t)}}else e.set("innerHTML",t)},_getElementValue:function(e){var t=e.get("nodeName").toLowerCase();if(t=="input"||t=="textarea"||t=="select"){var n=typeof FIELD_TYPES[e.get("type")]=="number"?FIELD_TYPES[e.get("type")]:e.get("type");switch(n){case FIELD_TYPES.checkbox:return e.get("checked")}return e.get("value")}return null},_generateScopeVarsCode:function(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r&&r._info&&r._info.parentType==DATA_ARRAY?e[n]=this.get("model")[r._info.parent][r._info.index]:e[n]=this.get("model")[n],t+=Y.Lang.sub(SCOPE_VAR_TEMPLATE,{scopeVarName:n})}return t},_generateUniqueKey:function(e,t){var n=e.split(".");if(n.length>1&&typeof t[n[0]]!="undefined"){var r=t[n[0]];e=(r._info&&r._info.parentType==DATA_ARRAY?r._info.parent+"."+r._info.index:"")+e}return e},_setModel:function(bindKey,value,scopeModel){var tokenizedKeys=bindKey.split(".");if(tokenizedKeys.length>1&&typeof scopeModel[tokenizedKeys[0]]!="undefined"){var scopeItem=scopeModel[tokenizedKeys[0]];if(scopeItem&&scopeItem._info&&scopeItem._info.parentType==DATA_ARRAY){tokenizedKeys.shift();var arrayItem=this.get("model")[scopeItem._info.parent][scopeItem._info.index];eval(this._generateObjectPropsAccessCode(tokenizedKeys,arrayItem));return}}if(tokenizedKeys.length>1&&typeof this.get("model")[tokenizedKeys[0]]!="undefined"){var scopeItem=scopeModel[tokenizedKeys[0]];return}this.get("model")[bindKey]=value},_getModel:function(e,t){var n=e.split(".");if(n.length>1&&typeof t[n[0]]!="undefined"){var r=t;for(var i=0;i<n.length;i++)r=r[n[i]];return r}return this.get("model")[e]},_generateObjectPropsAccessCode:function(e,t){var n='this.get("model")[scopeItem._info.parent][scopeItem._info.index]';return Y.Array.each(e,function(e){n+=Y.Lang.sub('["{property}"]',{property:e})}),n+" = value"},_getDirectiveName:function(e){return this.get("prefix")+e}},{ATTRS:{container:{value:null},model:{value:{}},controller:{value:{}},filters:{value:{}},templates:{value:{}},prefix:{value:"data-db"}}}),Y.Common.DomBind.Directives={},Y.Common.DomBind.createDirective=function(e,t){e="-"+e,Y.Common.DomBind.Directives[e]={directiveExecFn:t}},Y.Common.DomBind.createDirective("onclick",function(e,t,n,r){var i=this;this.attachEvent(t,"click",function(e){e.preventDefault(),i.execControllerMethodExpression(n,r,t)})}),Y.Common.DomBind.createDirective("onchange",function(e,t,n,r){var i=this;this.attachEvent(t,"change",function(e){e.preventDefault(),i.execControllerMethodExpression(n,r,t)})}),Y.Common.DomBind.createDirective("onfocus",function(e,t,n,r){var i=this;this.attachEvent(t,"focus",function(e){e.preventDefault(),i.execControllerMethodExpression(n,r,t)})}),Y.Common.DomBind.createDirective("onblur",function(e,t,n,r){var i=this;this.attachEvent(t,"blur",function(e){e.preventDefault(),i.execControllerMethodExpression(n,r,t)})}),Y.Common.DomBind.createDirective("bind",function(e,t,n,r){if(typeof t.getData(this.get("prefix")+DATA_IS_BINDED)=="undefined"){var i=this,s=this._generateUniqueKey(n,r);t.on(["keyup","change","click"],function(){i._getElementValue(t)!=t.getData("previousValue")&&(t.setData("previousValue",i._getElementValue(t)),i.setModel(n,i._getElementValue(t),r,t))});var o=this.listen(s,function(e){if(t._node!=null){if(typeof e.triggerElement=="undefined"||!e.triggerElement.compareTo(t))t.setData("previousValue"
,e.newValue),i._setElementValue(t,e.newValue)}else o.detach()});t.setData(this.get("prefix")+DATA_IS_BINDED,!0)}this._getModel(n,r)&&this.setModel(n,this._getModel(n,r),r)}),Y.Common.DomBind.createDirective("container-loop-model",function(e,t,n,r){var i=this,s=this.get("model");n=n.split(LOOP_DATA_FILTER);var o=n.length>1?this._tokenizeFilters(n[1].split(COMMA_SEPARATOR)):[];n=n[0],n=n.match(/[^ ]+/g);var u=n[2],a=s[u]&&s[u].length>0?s[u]:[],f=this.get("templates")[t.getAttribute(i._getDirectiveName(TEMPLATE))],l=function(e){t.empty(),Y.Array.each(e,function(e,s){var u=i._doBeforeEachItem(o,e),a=Y.Node.create(Y.Lang.sub(f,u)),l={containerNode:a,scopeModel:r};u._info={parent:n[2],parentType:DATA_ARRAY,index:s},l.scopeModel[n[0]]=u,i._compileDirectives(l),t.append(a),i._doAfterEachItem(o,e,a)})};l(a),this.listen(u,function(){l(i.get("model")[u])})})},"@VERSION@",{requires:["yui-base","base-build","node"]});
