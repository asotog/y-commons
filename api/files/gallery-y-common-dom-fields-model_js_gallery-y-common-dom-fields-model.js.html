<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>gallery-y-common-dom-fields-model/js/gallery-y-common-dom-fields-model.js - yogi doc server</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="yogi doc server"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.11.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="gallery-y-common-dom-fields-model_js_gallery-y-common-dom-fields-model.js.html#api-classes">Classes</a></li>
            <li><a href="gallery-y-common-dom-fields-model_js_gallery-y-common-dom-fields-model.js.html#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Common.Accordion.html">Common.Accordion</a></li>
            
                <li><a href="../classes/Common.CompoundTextField.html">Common.CompoundTextField</a></li>
            
                <li><a href="../classes/Common.DomBind.html">Common.DomBind</a></li>
            
                <li><a href="../classes/Common.DomFieldsModel.html">Common.DomFieldsModel</a></li>
            
                <li><a href="../classes/Common.Radios.html">Common.Radios</a></li>
            
                <li><a href="../classes/Common.Selects.html">Common.Selects</a></li>
            
                <li><a href="../classes/Common.SimpleValidator.html">Common.SimpleValidator</a></li>
            
                <li><a href="../classes/Common.TemplateHandler.html">Common.TemplateHandler</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/gallery-y-common-accordion.html">gallery-y-common-accordion</a></li>
            
                <li><a href="../modules/gallery-y-common-compound-textfield.html">gallery-y-common-compound-textfield</a></li>
            
                <li><a href="../modules/gallery-y-common-dom-fields-model.html">gallery-y-common-dom-fields-model</a></li>
            
                <li><a href="../modules/gallery-y-common-dombind.html">gallery-y-common-dombind</a></li>
            
                <li><a href="../modules/gallery-y-common-radios.html">gallery-y-common-radios</a></li>
            
                <li><a href="../modules/gallery-y-common-selects.html">gallery-y-common-selects</a></li>
            
                <li><a href="../modules/gallery-y-common-simple-validator.html">gallery-y-common-simple-validator</a></li>
            
                <li><a href="../modules/loader.html">loader</a></li>
            
                <li><a href="../modules/loader-yui3.html">loader-yui3</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: gallery-y-common-dom-fields-model/js/gallery-y-common-dom-fields-model.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * This module is an utility to retrieve all the form fields values
 *
 * @class DomFieldsModel
 * @namespace Common
 * @extends Base
 * @module gallery-y-common-dom-fields-model
 * @constructor
 */

Y.namespace(&#x27;Common&#x27;);

Y.Common.DomFieldsModel = Y.Base.create(&#x27;gallery-y-common-dom-fields-model&#x27;, Y.Base, [], {

    initializer: function () {
        var me = this;
    },
    
    /**
     * Save form fields into object or array, object when is passed a configuration in the constructor or array if only container is passed as attribute
     * 
     * @method save
     * 
     */
    save: function () {
        if (this.get(&#x27;configuration&#x27;)) {
            this._saveUsingConfiguration();
        } else {
            this._save();
        }
    },
    
    /**
     * 
     * Iterates over all the fields and then generates a fields array with the value obtained
     * 
     */
    _save: function () {
        var model = [];
        this.get(&#x27;container&#x27;).all(this.get(&#x27;formFieldsSelector&#x27;)).each(function (node) {
            var m = {};
            m[&#x27;node&#x27;] = node;
            if (node.get(&#x27;type&#x27;) == Y.Common.DomFieldsModel.statics.RADIO || node.get(&#x27;type&#x27;) == Y.Common.DomFieldsModel.statics.CHECK) {
                m[&#x27;value&#x27;] = node.get(&#x27;checked&#x27;);
            } else {
                m[&#x27;value&#x27;] = node.get(&#x27;value&#x27;);
            }
            model.push(m);
        });
        this.set(&#x27;model&#x27;, model);
    },

    /**
     * Using passed configuration object
     * 
     */
    _saveUsingConfiguration: function () {
        var me = this;
        var model = {};
        Y.Array.each(this.get(&#x27;configuration&#x27;), function (config) {
            if (config.type == Y.Common.DomFieldsModel.LIST) {
                model = me._saveList(config, model);
            } else {
                model[config.name] = me._retrieveFieldVal(me.get(&#x27;container&#x27;).one(me._getFieldSelector(config)), config);
            }
        });
        this.set(&#x27;model&#x27;, model);
    },

    /**
     * Loads previously saved data into fields
     *
     * @method load 
     * 
     */
    load: function () {
        if (this.get(&#x27;model&#x27;)) {
            if (this.get(&#x27;configuration&#x27;)) {
                this._loadUsingConfiguration();
            } else {
                this._load();
            }
        }
    },

    /**
     * Load all the fields as it
     * 
     */
    _load: function () {
        Y.Array.each(this.get(&#x27;model&#x27;), function (element) {
            if (element.node.get(&#x27;type&#x27;) == Y.Common.DomFieldsModel.statics.RADIO) {
                if (element.value) {
                    element.node.simulate(&#x27;click&#x27;);
                } else {
                    element.node.simulate(&#x27;change&#x27;);
                    return;
                }
            } else if (element.node.get(&#x27;type&#x27;) == Y.Common.DomFieldsModel.statics.CHECK) {
                element.node.set(&#x27;checked&#x27;, element.value);
            } else {
                element.node.set(&#x27;value&#x27;, element.value);
            }
            element.node.simulate(&#x27;change&#x27;);
        });
    },

    /**
     * Load the fields using configuration
     * 
     */
    _loadUsingConfiguration: function () {
        var me = this;
        Y.Array.each(this.get(&#x27;configuration&#x27;), function (config) {
            if (config.type == Y.Common.DomFieldsModel.STATIC) {
                /* nothing to do here */
            } else if (config.type == Y.Common.DomFieldsModel.LIST) {

            } else {
                me._loadField(me.get(&#x27;model&#x27;)[config.name], config, me.get(&#x27;container&#x27;));
            }
        });
    },

    /**
     * 
     */
    _loadField: function (value, config, container) {
        if (config.type == Y.Common.DomFieldsModel.RADIO) {

        } else {
            container.one(config.fieldSelector).set(&#x27;value&#x27;, value);
        }
    },

    /**
     * Saves the repeatable elements into a list
     *
     */
    _saveList: function (listConfig, model) {
        var me = this;
        model[listConfig.name] = [];
        this.get(&#x27;container&#x27;).all(listConfig.container).each(function (node) {
            var listItem = {};
            Y.Array.each(listConfig.fields, function (config) {
                listItem[config.name] = me._retrieveFieldVal(node.one(me._getFieldSelector(config)), config);
            });
            model[listConfig.name].push(listItem);
        });
        return model;
    },

    /**
     * 
     * 
     */
    _retrieveFieldVal: function (field, config) {
        var valueKey = (config.type == Y.Common.DomFieldsModel.STATIC) ? &#x27;innerHTML&#x27; : &#x27;value&#x27;;
        var value = field ? field.get(valueKey) : null;
        return (Y.Lang.trim(value) == &#x27;&#x27;) ? null : value;
    },

    /**
     * 
     */
    _getFieldSelector: function (config) {
        return (config.type == Y.Common.DomFieldsModel.RADIO) ? (config.fieldSelector + &#x27;:checked&#x27;) : config.fieldSelector;
    },
    
    /**
     * Converts list of model fields into object, key are going to be fields names, for model using configuration, keys are going to be using
     * the defined one in configuration
     * 
     * @method retrieveModel
     * @return {Object} Key/Value Object, key will be the field name
     * 
     */
    retrieveModel: function() {
        if (this.get(&#x27;configuration&#x27;)) {
            return this.get(&#x27;model&#x27;);
        } else {
            var processedModel = {};
            var model = this.get(&#x27;model&#x27;);
            for (var i = 0; i &lt; model.length; i++) {
                var field = model[i].node;
                var fieldName = field.get(&#x27;name&#x27;);
                if (field.get(&#x27;type&#x27;) == Y.Common.DomFieldsModel.statics.CHECK) {
                    processedModel[fieldName] = field.get(&#x27;checked&#x27;);
                } else if (field.get(&#x27;type&#x27;) == Y.Common.DomFieldsModel.statics.RADIO) {
                    processedModel[fieldName] = (field.get(&#x27;checked&#x27;) ? field.get(&#x27;value&#x27;) : (processedModel[fieldName] ? processedModel[fieldName] : null));
                } else {
                    processedModel[fieldName] = field.get(&#x27;value&#x27;);
                }
                
            }
            return processedModel;
        }
        
    },
    
    destructor: function () {

    }
}, {
    ATTRS: {

        /**
         * Container/Form node of the fields
         *
         * @attribute container
         * @type Y.Node
         * @default null
         *
         */
        container: {
            value: null
        },

        /**
         * Fields mapping configuration, this configuration can be passed in constructor when specific fields structure is required,
         * for example when there is a list of duplicable fields such a list of fields, this configuration tells the component how to parse this
         * structure of fields
         *
         * @comment This is a sample, type can be list, static, or radio
         * 
         * @attribute configuration
         * @type Array
         * @default null
         * 
         */
        /*[{
                fieldSelector: &#x27;.selector&#x27;,
                name: &#x27;birthdate&#x27;
            }, {
                type: &#x27;list&#x27;,
                 repeatable section 
                container: &#x27;.repeatable-item-wrapper&#x27;,
                name: &#x27;dependents&#x27;,
                fields: [{
                    fieldSelector: &#x27;.selector&#x27;,
                    name: &#x27;zipcode&#x27;
                }]
            }]*/

        configuration: {
            value: null
        },

        /**
         * Model that is going to be populated or used to load fields
         *
         * @attribute model
         * @type Object
         * @default null
         * 
         *
         */
        model: {
            value: null
        },

        
        /**
         * Selector to retrieve the fields that are going to processed
         * 
         * @attribute formFieldsSelector
         * @type String
         * @default &#x27;input[type=&quot;text&quot;],input[type=&quot;hidden&quot;],input[type=&quot;radio&quot;],input[type=&quot;checkbox&quot;],select&#x27;
         * 
         */ 
        formFieldsSelector: {
            value: &#x27;input[type=&quot;text&quot;],input[type=&quot;hidden&quot;],input[type=&quot;radio&quot;],input[type=&quot;checkbox&quot;],select&#x27;
        }
    }
});

Y.Common.DomFieldsModel.statics = {
    LIST: &#x27;list&#x27;,
    STATIC: &#x27;static&#x27;,
    RADIO: &#x27;radio&#x27;,
    CHECK: &#x27;checkbox&#x27;
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
